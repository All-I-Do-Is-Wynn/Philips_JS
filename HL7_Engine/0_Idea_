HL7 Engine Roadmap to Start
1.) Prototype a message listener
- Build a simple MLLP listener for HL7 v2 ADT messages.
- Build a REST client to query FHIR Patient resources.

2.) Create a parser/transformer
- Parse HL7 v2 segments into JSON.
- Map FHIR JSON into your internal model.

3.) Implement routing logic
- Route ADT messages to a mock MPI database.
- Route lab results to a file drop.

4.) Add monitoring
- Log every message.
- Build a dashboard showing counts and errors.

5.) Expand adapters
- Add support for SFTP, databases, cloud APIs.
- Add retry/error queues.

6.) Connect to Epic/Cerner test environments
- Epic: use their sandbox HL7 v2 feeds and open.epic FHIR APIs.
- Cerner: use their Millennium FHIR sandbox.





                   ┌──────────────────────────────┐
                   │       Integration Engine     │
                   └──────────────────────────────┘
                                │
        ┌───────────────────────┼────────────────────────┐
        │                       │                        │
        ▼                       ▼                        ▼
┌──────────────┐       ┌────────────────┐       ┌──────────────────┐
│ HL7 v2 MLLP  │       │  FHIR REST API │       │ Admin / Dashboard │
│ Listener     │       │ Listener       │       │         │
│ (TCP 2575)   │       │ (HTTP 3000)    │       │ (HTTP 8081)       │
└──────────────┘       └────────────────┘       └──────────────────┘
        │                       │
        ▼                       ▼
┌──────────────┐       ┌────────────────┐
│ HL7 Parser   │       │ FHIR Validator │
│ (segments)   │       │ (JSON schema)  │
└──────────────┘       └────────────────┘
        │                       │
        └──────────────┬────────┘
                       ▼
             ┌────────────────────┐
             │ Routing Layer      │
             │ (rules, mapping)   │
             └────────────────────┘
                       │
                       ▼
             ┌────────────────────┐
             │Transformation Layer│
             │HL7 ↔ FHIR mapping  │
             └────────────────────┘
                       │
                       ▼
             ┌────────────────────┐
             │Storage / Queueing  │
             │(DB, Kafka, Redis)  │
             └────────────────────┘
                       │
                       ▼
             ┌────────────────────┐
             │Downstream Systems  │
             │(EHR, LIS, RIS, etc)│
             └────────────────────┘

HL7 Workflow:
MLLP Listener → HL7 Parser → Router → Transformer → Storage → Downstream

FHIR Workflow:
FHIR Listener → JSON Validator → Router → Transformer → Storage → Downstream



HL7 Listener (TCP 2575)        FHIR Listener (HTTP 3000)
          │                               │
          ▼                               ▼
   HL7 Parser                        FHIR Validator
          │                               │
          └──────────────┬────────────────┘
                         ▼
              Normalized Message Object
                         │
                         ▼
                  Routing Layer
                         │
        ┌────────────────┼────────────────┐
        ▼                ▼                ▼
 PatientPipeline   LabPipeline    EncounterPipeline
        │                │                │
        ▼                ▼                ▼
   Transform HL7↔FHIR   Save to DB   Forward to EHR
        │                │                │
        ▼                ▼                ▼
 Downstream Systems (Epic, Cerner, DB)


UI Output workflow
UI → WebSocket → routeMessage() → runPipeline() → pipeline → runPipeline() → routeMessage() → WebSocket → UI


Frontend UI -> Websocket -> Engine
UI Button Click
    ▼
WebSocket Command
    ▼
Backend WebSocket Server
    ▼
Engine Component (preview, route, send)
    ▼
Backend sends:
    - logs
    - preview output
    - routed HL7/FHIR
    ▼
UI updates:
    - Terminal log panel
    - Preview panel




FHIR Workflow
┌──────────────────────────────────────────────────────────────┐
│                        FRONTEND UI                           │
│  - User clicks: Preview FHIR, Run FHIR Route, Send FHIR      │
│  - UI sends WebSocket commands:                              │
│      { action: "preview-fhir", index }                       │
│      { action: "run-route-fhir", index }                     │
│      { action: "send-fhir", index }                          │
└───────────────┬──────────────────────────────────────────────┘
                │ WebSocket message
                ▼
┌──────────────────────────────────────────────────────────────┐
│                        WEBSOCKET SERVER                      │
│  - Receives UI command                                       │
│  - Loads FHIR resource from fhirResources[index]             │
│  - Sends logs + preview back to UI                           │
└───────────────┬──────────────────────────────────────────────┘
                │ FHIR JSON
                ▼
┌──────────────────────────────────────────────────────────────┐
│                           PARSER                             │
│  - JSON.parse()                                              │
│  - Produces JS object                                        │
└───────────────┬──────────────────────────────────────────────┘
                │ Parsed FHIR
                ▼
┌──────────────────────────────────────────────────────────────┐
│                        NORMALIZER (FHIR)                     │
│  - Converts FHIR → NMO                                       │
│  - Standardizes structure for routing/mapping                │
└───────────────┬──────────────────────────────────────────────┘
                │ NMO
                ▼
┌──────────────────────────────────────────────────────────────┐
│                           ROUTER                             │
│  - Reads resourceType, event, metadata                       │
│  - Chooses pipeline:                                         │
│      FHIR→HL7                                                │
│      FHIR→FHIR                                               │
└───────────────┬──────────────────────────────────────────────┘
                │ Routed NMO
                ▼
┌──────────────────────────────────────────────────────────────┐
│                           PIPELINE                           │
│  - Calls mapping engine                                      │
│  - Applies transformations                                   │
└───────────────┬──────────────────────────────────────────────┘
                │ Transformed NMO
                ▼
┌──────────────────────────────────────────────────────────────┐
│                           MAPPING                            │
│  - FHIR→HL7: Patient, Observation, Encounter, etc.           │
│  - FHIR→FHIR: resource transforms                            │
└───────────────┬──────────────────────────────────────────────┘
                │ Final structured output
                ▼
┌──────────────────────────────────────────────────────────────┐
│                          SERIALIZER                          │
│  - HL7: segmentsToHL7()                                      │
│  - FHIR: JSON.stringify()                                    │
└───────────────┬──────────────────────────────────────────────┘
                │ HL7 string or FHIR JSON
                ▼
┌──────────────────────────────────────────────────────────────┐
│                        SENDER CLIENTS                        │
│  - MLLP Sender → downstream HL7 system                       │
│  - FHIR Sender → REST endpoint                               │
└──────────────────────────────────────────────────────────────┘



HL7 Workflow
┌──────────────────────────────────────────────────────────────┐
│                        FRONTEND UI                           │
│  - User clicks: Preview HL7, Run HL7 Route, Send HL7         │
│  - UI sends WebSocket commands:                              │
│      { action: "preview-hl7", index }                        │
│      { action: "run-route-hl7", index }                      │
│      { action: "send-hl7", index }                           │
└───────────────┬──────────────────────────────────────────────┘
                │ WebSocket message
                ▼
┌──────────────────────────────────────────────────────────────┐
│                        WEBSOCKET SERVER                      │
│  - Receives UI command                                       │
│  - Loads HL7 message from hl7Messages[index]                 │
│  - Sends logs + preview back to UI                           │
└───────────────┬──────────────────────────────────────────────┘
                │ HL7 string
                ▼
┌──────────────────────────────────────────────────────────────┐
│                           PARSER                             │
│  - Splits HL7 into segments/fields                           │
│  - Produces structured JS object                             │
└───────────────┬──────────────────────────────────────────────┘
                │ Parsed HL7
                ▼
┌──────────────────────────────────────────────────────────────┐
│                        NORMALIZER (HL7)                      │
│  - Converts parsed HL7 → NMO (Normalized Message Object)     │
│  - Standard field names, predictable structure               │
└───────────────┬──────────────────────────────────────────────┘
                │ NMO
                ▼
┌──────────────────────────────────────────────────────────────┐
│                           ROUTER                             │
│  - Reads NMO metadata (MSH-9, facility, event)               │
│  - Chooses pipeline:                                         │
│      HL7→HL7 (transform only)                                │
│      HL7→FHIR (mapping)                                      │
└───────────────┬──────────────────────────────────────────────┘
                │ Routed NMO
                ▼
┌──────────────────────────────────────────────────────────────┐
│                           PIPELINE                           │
│  - Calls mapping engine                                      │
│  - Applies transformations                                   │
│  - Prepares output for serialization                         │
└───────────────┬──────────────────────────────────────────────┘
                │ Transformed NMO
                ▼
┌──────────────────────────────────────────────────────────────┐
│                           MAPPING                            │
│  - HL7→FHIR: ADT, ORU, SIU, etc.                             │
│  - HL7→HL7: segment-level transforms                         │
└───────────────┬──────────────────────────────────────────────┘
                │ Final structured output
                ▼
┌──────────────────────────────────────────────────────────────┐
│                          SERIALIZER                          │
│  - HL7: segmentsToHL7()                                      │
│  - FHIR: JSON.stringify()                                    │
└───────────────┬──────────────────────────────────────────────┘
                │ HL7 string or FHIR JSON
                ▼
┌──────────────────────────────────────────────────────────────┐
│                        SENDER CLIENTS                        │
│  - MLLP Sender → downstream HL7 system                       │
│  - FHIR Sender → REST endpoint                               │
└──────────────────────────────────────────────────────────────┘
